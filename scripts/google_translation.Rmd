---
title: "google translate"
output: html_document
date: "2026-01-02"
---

```{r}
install.packages(c("httr", "jsonlite", "readr", "dplyr"))

```
```{r}
library(httr)
library(jsonlite)
library(readr)
library(dplyr)

```

```{r}
GOOGLE_API_KEY <- "AIzaSyC_hYjHMEqCh3kr8_l8JMMvTineh0Uydfs"

```

```{r}
google_translate <- function(text, target = "en", source = "da", api_key) {
  
  if (is.na(text) || nchar(trimws(text)) == 0) {
    return(NA_character_)
  }
  
  url <- "https://translation.googleapis.com/language/translate/v2"
  
  response <- POST(
    url,
    query = list(key = api_key),
    body = list(
      q = text,
      source = source,
      target = target,
      format = "text"
    ),
    encode = "json"
  )
  
  if (status_code(response) != 200) {
    stop(content(response, "text", encoding = "UTF-8"))
  }
  
  result <- content(response, as = "parsed", simplifyVector = TRUE)
  result$data$translations$translatedText
}

```

```{r}
df <- read_csv(
  "/work/pilot/data/processed/full_df.csv",
  show_col_types = FALSE
)

if (!"eng_text" %in% names(df)) {
  df$eng_text <- NA_character_
}

```

```{r}
for (i in seq_len(nrow(df))) {
  
  if (!is.na(df$eng_text[i])) {
    cat("Row", i, "already translated – skipping\n")
    next
  }
  
  tryCatch({
    df$eng_text[i] <- google_translate(
      text = df$text[i],
      api_key = GOOGLE_API_KEY
    )
    
    cat("Row", i, "translated\n")
    
    # save progress
    write_csv(df, "/work/pilot/data/processed/full_df.csv")
    
    Sys.sleep(0.1)  # rate-limit safety
    
  }, error = function(e) {
    cat("ERROR at row", i, ":", e$message, "\n")
    write_csv(df, "/work/pilot/data/processed/full_df.csv")
    stop("Stopped — progress saved")
  })
}

cat(" translation completed\n")

```

```{r}
#test if translation works
test <- google_translate(
  text = "Hej",
  api_key = GOOGLE_API_KEY
)
print(test)

```

